{ "name": "Authentication",
  "memberOf": "wix-members-backend",
  "mixes": [],
  "labels":
    [ "new" ],
  "location":
    { "lineno": 29,
      "filename": "index.js" },
  "docs":
    { "summary": "The Authentication API contains functionality for authenticating users from backend code.",
      "description":
        [ "To use the Authentication API, import `{authentication}` from the `wix-members-backend` module:",
          "",
          "```javascript",
          "import { authentication } from 'wix-members-backend';",
          "```" ],
      "links": [],
      "examples": [],
      "extra":
        {  } },
  "properties": [],
  "operations":
    [ { "name": "generateSessionToken",
        "labels": [],
        "nameParams": [],
        "params":
          [ { "name": "email",
              "type": "string",
              "doc": "Login email address of the member to approve." } ],
        "ret":
          { "type":
              { "name": "Promise",
                "typeParams":
                  [ "string" ] },
            "doc": "Fulfilled - Session token apply in page code to log the authenticated member in." },
        "locations":
          [ { "lineno": 1,
              "filename": "generateSessionToken.js" } ],
        "docs":
          { "summary": "Creates a session token for a member authenticated by a 3rd party.",
            "description":
              [ "<!--ONLY:VELO-->",
                "The `generateSessionToken()` function returns a Promise that resolves to a session token",
                "used to log a member in to your site.",
                "",
                "> **Note:**",
                "> This function replaces the deprecated",
                "> `generateSessionToken()` from `wix-users-backend`.",
                "> The deprecated function will continue to work, but it will not receive updates.",
                "> To keep any existing code compatible with future changes,",
                "> see the migration instructions at",
                "> [`wix-users-backend.generateSessionToken()`](wix-users-backend/generateSessionToken).",
                "",
                "Use `generateSessionToken()` to bypass Wix member authentication",
                "when using a 3rd-party service to authenticate your members.",
                "For example, you can use `generateSessionToken()`",
                "to provide Single Sign-On (SSO) for members",
                "where they authenticate with a non-Wix entity to log in to your Wix site.",
                "",
                "If the specified email address corresponds to an existing member,",
                "a session token for logging in that member is generated.",
                "",
                "If there is no existing member with the specified email address,",
                "a new member is created and a session token for logging in that member is generated.",
                "The member is created with a random password.",
                "<!--END:ONLY:VELO-->" ],
            "links": [],
            "examples":
              [ { "title": "Generate a session token",
                  "body":
                    [ "import { authentication } from 'wix-members-backend';",
                      "",
                      "export function myGenerateSessionTokenFunction() {",
                      "  const email = \"joni.doe@example.com\";",
                      "",
                      "  return authentication.generateSessionToken(email)",
                      "  .then((sessionToken) => {",
                      "    return sessionToken;",
                      "  })",
                      "  .catch((error) => {",
                      "    console.error(error);",
                      "  });",
                      "}",
                      "",
                      "/* Promise resolves to a session token:",
                      " * \"JWS.eyJraWQiOiJQSXpvZGJiQiIsImFsZyI6IkhTMjU2In0.eyJkYXRhIjoie1wiaWRcIjpcImM2OTE2N2FmLTY0ODgtNDYzNS1iYmU3LTg5YzFjZWY2MTEwN1wiLFwiY29sbGVjdGlvbklkXCI6XCI5YmVjNThlNi02NDExLTQ5OTEtOGU1ZC0wYWRhOTE4MmI5NWVcIixcIm1ldGFTaXRlSWRcIjpcIjFmZjQ2YTk2LWRlYTYtNDlkYS04M2JhLTUxNjRmYjYyZDgzOVwiLFwib3duZXJcIjpmYWxzZSxcImNyZWF0aW9uVGltZVwiOjE2MjI0MDMwOTM5MTEsXCJleHBpcmVzSW5cIjoxMjA5NjAwMDAwLFwiZXhwaXJhdGlvblRpbWVcIjoxNjIyNDAzMjEzOTExLFwibGFzdFJlZnJlc2hlZFwiOjAsXCJhZG1pblwiOmZhbHNlfSIsImlhdCI6MTYyMjQwMzA5M30.xDMCeRG2DIDa4YR6_XuTf7KBRgHFb0qW7K6gsVMLXUM\"",
                      " */" ],
                  "extra":
                    {  } },
                { "title": "Log a member in after 3rd-party authentication",
                  "body":
                    [ "/****************************",
                      " * Backend code - login.jsw *",
                      " ***************************/",
                      "",
                      " import { authentication } from 'wix-members-backend';",
                      " import { authBy3rdParty } from 'backend/authentications';",
                      "",
                      " export function getLoginToken(email, password) {",
                      "",
                      "   return authBy3rdParty(email, password)",
                      "     .then((isAuthenticated) => {",
                      "",
                      "       // If authenticated, generate and return the session token",
                      "       if (isAuthenticated) {",
                      "         return authentication.generateSessionToken(email)",
                      "           .then((sessionToken) => {",
                      "             return {",
                      "               sessionToken: sessionToken,",
                      "               approved: true",
                      "            };",
                      "           });",
                      "       }",
                      "",
                      "       // If not authenticated, return non-approval",
                      "       return { approved: false };",
                      "     });",
                      " }",
                      "",
                      " /*************",
                      "  * Page code *",
                      "  ************/",
                      " import { getLoginToken } from 'backend/login';",
                      " import { authentication } from 'wix-members';",
                      "",
                      " export async function button_onClick(event) {",
                      "",
                      "  // Call the backend function to get the session token",
                      "   getLoginToken($w(\"#email\").value, $w(\"#password\").value)",
                      "     .then((loginResult) => {",
                      "       if (loginResult.approved) {",
                      "         // If approved, log the member in using the returned session token",
                      "         authentication.applySessionToken(loginResult.sessionToken);",
                      "       } else {",
                      "         // If not approved, log a message",
                      "         console.log(\"Member not approved.\");",
                      "       }",
                      "     });",
                      " }",
                      "" ],
                  "extra":
                    { "description": "This example contains a backend function\nwhich uses a 3rd-party authentication service to authenticate a member.\nIf the authentication is successful,\na session token is returned to the page\nand used to log the authenticated member in." } } ],
            "extra":
              {  } },
        "extra":
          {  } },
      { "name": "login",
        "labels": [],
        "nameParams": [],
        "params":
          [ { "name": "email",
              "type": "string",
              "doc": "Member login email address." },
            { "name": "password",
              "type": "string",
              "doc": "Password to use when logging the member in." } ],
        "ret":
          { "type":
              { "name": "Promise",
                "typeParams":
                  [ "string" ] },
            "doc": "Fulfilled - Session token for logging the member in.\nRejected - Error message." },
        "locations":
          [ { "lineno": 1,
              "filename": "login.js" } ],
        "docs":
          { "summary": "Logs a member in with an email and password.",
            "description":
              [ "<!--ONLY:VELO-->",
                "The `login()` function returns a Promise that resolves to a session token",
                "used to log a member in to your site.",
                "",
                "> **Note:**",
                "> This function replaces the deprecated",
                "> `login()` from `wix-users-backend`.",
                "> The deprecated function will continue to work, but it will not receive updates.",
                "> To keep any existing code compatible with future changes,",
                "> see the migration instructions at",
                "> [`wix-users-backend.login()`](wix-users-backend/login).",
                "",
                "To complete the login,",
                "the returned session token must be applied using the",
                "[`applySessionToken()`](wix-members/authentication-obj/applysessiontoken)",
                "function in page code.",
                "<!--END:ONLY:VELO-->" ],
            "links": [],
            "examples":
              [ { "title": "Generate a session token if a valid email and password are provided",
                  "body":
                    [ "import { authentication } from 'wix-members-backend';",
                      "",
                      "export function myLoginFunction() {",
                      "  const email = \"joni.doe@example.com\";",
                      "  const password = \"12345\";",
                      "",
                      "  return authentication.login(email, password)",
                      "  .then((sessionToken) => {",
                      "    return sessionToken;",
                      "  })",
                      "  .catch((error) => {",
                      "    console.error(error);",
                      "  });",
                      "}",
                      "",
                      "/* Promise resolves to a session token:",
                      " * \"JWS.eyJraWQiOiJQSXpvZGJiQiIsImFsZyI6IkhTMjU2In0.eyJkYXRhIjoie1wiaWRcIjpcIjg4MzFlZWQ2LTkyOGUtNGY4NS1iODBhLWUxZTQ4ZmI3YzRmZFwiLFwiY29sbGVjdGlvbklkXCI6XCI5YmVjNThlNi02NDExLTQ5OTEtOGU1ZC0wYWRhOTE4MmI5NWVcIixcIm1ldGFTaXRlSWRcIjpcIjFmZjQ2YTk2LWRlYTYtNDlkYS04M2JhLTUxNjRmYjYyZDgzOVwiLFwib3duZXJcIjpmYWxzZSxcImNyZWF0aW9uVGltZVwiOjE2MjI0MTUxMTMyNjYsXCJleHBpcmVzSW5cIjoxMjA5NjAwMDAwLFwiZXhwaXJhdGlvblRpbWVcIjoxNjIyNDE1MjMzMjY2LFwibGFzdFJlZnJlc2hlZFwiOjAsXCJhZG1pblwiOmZhbHNlfSIsImlhdCI6MTYyMjQxNTExM30.CFJTkyDaF6LypH8UuNm74qgZMxTKFgB1ZnzsemhY_KY\"",
                      " */" ],
                  "extra":
                    {  } },
                { "title": "Log a member in after they provide an email and password",
                  "body":
                    [ "/****************************",
                      " * Backend code - login.jsw *",
                      " ***************************/",
                      "",
                      "import { authentication } from 'wix-members-backend';",
                      "",
                      "export function getLoginToken(email, password) {",
                      "",
                      "return authentication.login(email, password)",
                      "  .then((sessionToken) => {",
                      "    // If the promise resolves, the member is authenticated and can be logged in",
                      "    return {",
                      "      sessionToken: sessionToken,",
                      "      approved: true",
                      "    };",
                      "  })",
                      "  .catch((error) => {",
                      "    // If the promise is rejected, the member is not authenticated",
                      "    // and cannot be logged in",
                      "    console.error(error);",
                      "    return {",
                      "      approved: false,",
                      "      error: error",
                      "    };",
                      "  });",
                      "}",
                      "",
                      "",
                      "/*************",
                      "* Page code *",
                      "************/",
                      "import { getLoginToken } from 'backend/login';",
                      "import { authentication } from 'wix-members';",
                      "",
                      "export async function button_onClick(event) {",
                      "",
                      "  // Call the backend function to get the session token",
                      "  getLoginToken($w(\"#email\").value, $w(\"#password\").value)",
                      "    .then((loginResult) => {",
                      "      if (loginResult.approved) {",
                      "        // If approved, log the member in using the returned session token",
                      "        authentication.applySessionToken(loginResult.sessionToken);",
                      "      } else {",
                      "        // If not approved, log a message",
                      "        console.log(\"Member not approved.\");",
                      "      }",
                      "    });",
                      " }",
                      "" ],
                  "extra":
                    { "description": "This example contains a backend function\nwhich authenticates a member based on the provided email and password.\nIf the authentication is successful,\na session token is returned to the page\nand used to log the authenticated member in." } } ],
            "extra":
              {  } },
        "extra":
          {  } } ],
  "callbacks": [],
  "messages": [],
  "extra":
    {  } }